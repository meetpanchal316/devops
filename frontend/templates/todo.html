<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do Form</title>
</head>
<body>

    <h1>Add a To-Do Item</h1>

    <form action="/submittodoitem" method="post">
        <label for="itemId">Item ID</label>
        <input type="text" id="itemId" name="itemId" placeholder="Enter item id" required>
        <br><br>

        <label for="itemUuid">Item UUID</label>
        <input type="text" id="itemUuid" name="itemUuid" placeholder="Auto-generated UUID">
        <br><br>

        <label for="itemHash">Item Hash</label>
        <input type="text" id="itemHash" name="itemHash" placeholder="Auto-generated hash">
        <br><br>
        
        <label for="itemName">Item Name</label>
        <input type="text" id="itemName" name="itemName" placeholder="Enter item name" required>
        <br><br>

        <label for="itemDescription">Item Description</label><br>
        <textarea id="itemDescription" name="itemDescription" rows="4" cols="30" placeholder="Enter description" required></textarea>
        <br><br>

        <input type="submit" value="Submit To-Do">
    </form>

</body>

<script>
  function genUUID() {
    return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
      (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
    );
  }
  
  async function sha256hex(str) {
    const enc = new TextEncoder();
    const buf = await crypto.subtle.digest('SHA-256', enc.encode(str));
    return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
  }

  document.addEventListener('DOMContentLoaded', () => {
    const idInput = document.getElementById('itemId');
    const nameInput = document.getElementById('itemName');
    const hashInput = document.getElementById('itemHash');

    async function updateHash(){
      const s = (idInput?.value || '') + '|' + (nameInput?.value || '');
      hashInput.value = await sha256hex(s);
    }

    // update hash on changes
    [idInput, nameInput].forEach(el => {
      if (el) el.addEventListener('input', updateHash);
    });

    // initial fill
    updateHash();
  });

  document.addEventListener('DOMContentLoaded', function(){
    const uuidInput = document.getElementById('itemUuid');
    if (uuidInput && !uuidInput.value) uuidInput.value = genUUID();
  });
</script>
</html>
